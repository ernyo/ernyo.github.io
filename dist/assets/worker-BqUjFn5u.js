(function(){"use strict";function T(e){let n=e>>>0;return function(){n+=1831565813;let t=Math.imul(n^n>>>15,1|n);return t^=t+Math.imul(t^t>>>7,61|t),((t^t>>>14)>>>0)/4294967296}}function k(e,n,t){return Math.hypot(e,n)-t}function B(e,n,t,h){const y=Math.abs(e)-t,s=Math.abs(n)-h,a=Math.max(y,0),f=Math.max(s,0);return Math.hypot(a,f)+Math.min(Math.max(y,s),0)}function E(e,n,t){const h=Math.sqrt(3);if(e/=t,n/=t,e=Math.abs(e)-1,n=n+1/h,e+h*n>0){const s=(e-h*n)*.5,a=(-h*e-n)*.5;e=s,n=a}return e=e-Math.max(Math.min(e,0),-2),-Math.hypot(e,n)*Math.sign(n)*t}function O(e,n,t,h){let s=Math.atan2(n,e)%(2*Math.PI/5);s<0&&(s+=2*Math.PI/5);const a=s/(2*Math.PI/5),f=a<.5?t+(h-t)*(a*2):h+(t-h)*((a-.5)*2);return Math.hypot(e,n)-f}function X(e,n,t,h,y){const s=e-t,a=n-h,f=Math.cos(y),i=Math.sin(y);return{x:s*f+a*i,y:-s*i+a*f}}function Y(e,n,t,h,y,s,a){const f=n/s,i=t/s;if(e==="circle")return(1-Math.min(1,Math.hypot(n,t)/s))*8;if(e==="square"){const l=(a()-.5)*2,o=(a()-.5)*2;return(l*f+o*i)*8}else if(e==="triangle"){const l=(a()-.5)*2,o=(a()-.5)*2;return .8*(l*f-o*i)*8}else{const l=Math.hypot(n,t);return .6*Math.cos(.2*l)*8}}function j(e){const n=[[30,30,30],[242,85,85],[85,180,245],[120,235,120],[245,205,85]];return n[Math.min(e,n.length-1)]}function G(e){const n=e.H,t=e.W,h=e.nShapes,y=e.seed,s=T(y>>>0),a=new Uint8ClampedArray(n*t*3),f=new Uint8ClampedArray(n*t),i=new Uint8ClampedArray(n*t),l=new Uint8ClampedArray(n*t),o=new Float32Array(n*t);o.fill(-1e9);for(let c=0;c<n*t;c++)a[c*3+0]=30,a[c*3+1]=30,a[c*3+2]=30;const m=Math.min(n,t),I=e.minScale??.3,F=e.maxScale??.5;s()*2*Math.PI;const H=.25;for(let c=0;c<h;c++){const M=e.typeShapes[s()*e.typeShapes.length|0],u=(I+s()*(F-I))*.5*m,v=t*(.2+.6*s()),D=n*(.2+.6*s()),K=s()*2*Math.PI;for(let A=0;A<n;A++)for(let C=0;C<t;C++){const d=A*t+C,p=X(C+.5,A+.5,v,D,K);let S=0;if(M==="circle"?S=k(p.x,p.y,u):M==="square"?S=B(p.x,p.y,u,u):M==="triangle"?S=E(p.x,p.y,u):S=O(p.x,p.y,u,u*.5),S<=0){const U=Y(M,p.x,p.y,v,D,u,s);if(U>o[d]){o[d]=U;const w=e.typeShapes.indexOf(M)+1;f[d]=w,l[d]=255;const q=Math.max(H,H+.07*U),z=j(w);a[d*3+0]=Math.min(255,q*z[0]|0),a[d*3+1]=Math.min(255,q*z[1]|0),a[d*3+2]=Math.min(255,q*z[2]|0)}const W=Math.abs(S);if(W<1.2){const w=Math.max(0,Math.min(1,1-W/1.2));i[d]=Math.max(i[d],w*255|0)}}}}let b=1/0,x=-1/0;for(let c=0;c<n*t;c++)o[c]>-1e8&&(o[c]<b&&(b=o[c]),o[c]>x&&(x=o[c]));const P=new Uint8ClampedArray(n*t),r=new Uint8ClampedArray(n*t*3);if(isFinite(b)&&isFinite(x)&&x>b){const c=255/(x-b);for(let M=0;M<n*t;M++)P[M]=o[M]>-1e8?(o[M]-b)*c|0:0}for(let c=0;c<n;c++){const M=Math.max(0,c-1),N=Math.min(n-1,c+1);for(let u=0;u<t;u++){const v=Math.max(0,u-1),D=Math.min(t-1,u+1),K=o[M*t+v],A=o[M*t+D],C=o[N*t+v],d=o[N*t+D],p=(A-K+d-C)*.5,S=(C-K+d-A)*.5;let U=-p,W=-S,w=1;const q=1/Math.max(1e-6,Math.hypot(U,W,w));U*=q,W*=q,w*=q;const z=c*t+u;r[z*3+0]=(U+1)*127.5|0,r[z*3+1]=(W+1)*127.5|0,r[z*3+2]=(w+1)*127.5|0}}const g=1,L=e.typeShapes.length;return{H:n,W:t,K:L,N:g,rgb:a,seg:f,edge:i,sal:l,depth:P,normal:r}}function J(e){return e&&typeof e.H=="number"&&typeof e.W=="number"&&typeof e.nShapes=="number"&&typeof e.batch=="number"&&typeof e.seed=="number"}self.onmessage=e=>{if(!J(e.data))return;const{H:n,W:t,nShapes:h,typeShapes:y,batch:s,seed:a}=e.data,f=new Array(s);for(let r=0;r<s;r++)f[r]=G({H:n,W:t,nShapes:h,typeShapes:y,seed:a+r});const i=s,l=3,o=f[0].K,m=n*t,I=new Uint8ClampedArray(i*m*l),F=new Uint8ClampedArray(i*m),H=new Uint8ClampedArray(i*m),b=new Uint8ClampedArray(i*m),x=new Uint8ClampedArray(i*m),P=new Uint8ClampedArray(i*m*l);for(let r=0;r<i;r++){const g=f[r];I.set(g.rgb,r*m*l),F.set(g.seg,r*m),H.set(g.edge,r*m),b.set(g.sal,r*m),x.set(g.depth,r*m),P.set(g.normal,r*m*l)}self.postMessage({H:n,W:t,K:o,N:i,rgb:I,seg:F,edge:H,sal:b,depth:x,normal:P},[I.buffer,F.buffer,H.buffer,b.buffer,x.buffer,P.buffer])}})();
